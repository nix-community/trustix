<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Trustix Doc</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="about.html"><strong aria-hidden="true">1.</strong> About</a></li><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">2.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="howto-nix/index.html"><strong aria-hidden="true">3.</strong> How to use Trustix with Nix</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="howto-nix/setup.html"><strong aria-hidden="true">3.1.</strong> Basic setup</a></li><li class="chapter-item expanded "><a href="howto-nix/colmena/index.html"><strong aria-hidden="true">3.2.</strong> Builder setup (using Colmena)</a></li><li class="chapter-item expanded "><a href="howto-nix/subscribing.html"><strong aria-hidden="true">3.3.</strong> Subscribing</a></li><li class="chapter-item expanded "><a href="howto-nix/binarycache.html"><strong aria-hidden="true">3.4.</strong> Usage as a binary cache</a></li></ol></li><li class="chapter-item expanded "><a href="hacking.html"><strong aria-hidden="true">4.</strong> Hacking</a></li><li class="chapter-item expanded "><a href="api.html"><strong aria-hidden="true">5.</strong> API docs</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Trustix Doc</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="about"><a class="header" href="#about">About</a></h1>
<h2 id="trustix---build-transparency-reference-implementation"><a class="header" href="#trustix---build-transparency-reference-implementation"><a href="https://github.com/nix-community/trustix">Trustix</a> - build transparency reference implementation</a></h2>
<p><a href="https://asciinema.org/a/384552"><img src="https://asciinema.org/a/384552.png" alt="asciicast" /></a></p>
<h2 id="agree-on-inputs-agree-on-outputs"><a class="header" href="#agree-on-inputs-agree-on-outputs">Agree on inputs; agree on outputs</a></h2>
<p>Trustix works by associating a hash of the inputs to a build with a hash of the resulting output. Reproducibility means that if multiple builders started with the same inputs, they should produce the same output. By comparing across builders, we can detect problems such as non-reproducibility and trojan viruses. By tracking the history of a build, we can ascertain security compromises, track build quality, and help build trust over time for a given system and provider.</p>
<h2 id="binary-planting-protection"><a class="header" href="#binary-planting-protection">Binary planting protection</a></h2>
<p>When we download a program, we typically trust that the binaries correspond to the program that we want. But how can we be sure that what we get is actually what we want, and not something malicious?</p>
<p>The trust we have in what we download is generally a proxy for the trust we have in the provider we download it from. This provider can put in place various measures to protect against attacks such as <a href="https://en.wikipedia.org/w/index.php?title=Man-in-the-middle_attack">man-in-the-middle attacks</a>, usually by using cryptographic hashes or digital signatures. These would protect against tampering in transit, but would not protect us if the binary was already compromised.</p>
<p>For example, the build infrastructure of the provider might be compromised, such that even if good source code goes in, bad binaries come out. This turns the provider into a single point of failure for trust.</p>
<p>Trustix makes it easy to distribute this responsibility among a number of non-authoritative peers. By comparing the build results between various providers, we can ascertain whether one or more might have been compromised.</p>
<h2 id="tamper-evident-history"><a class="header" href="#tamper-evident-history">Tamper-evident history</a></h2>
<p>Even if a provider's private key is compromised and an attacker gains unrestricted access, Trustix's immutable build log ensures that any modification to old entries can be detected and flagged. Any entries known to be from before the attack can still be trusted.</p>
<p>Since the build log provided by trustix is additive, we can ascertain when exactly a provider might have been compromised. Any binaries from before this point can still be trusted. Any modification of the log history is easily detected by peers, making history tampering impossible.</p>
<h2 id="decide-your-level-of-trust"><a class="header" href="#decide-your-level-of-trust">Decide your level of trust</a></h2>
<p>There is no universal notion of &quot;verified&quot;; you decide which providers to trust and how much. Your personal security needs may be low, in which case you can trust any binary cache on your list. In your high-security environment, however, you may require every provider to agree on the same output in order to trust any of them.</p>
<h2 id="analyze-package-reproducibility"><a class="header" href="#analyze-package-reproducibility">Analyze package reproducibility</a></h2>
<p>In the real world, builds are often non-reproducible without being maliciously modified. The build output might contain the time or date, or a reference to a local folder used during the build process. While most of these cases are benign, we can't really tell. The answer is to measure and track reproducibility. By comparing what different providers build on different machines and in different circumstances, we can track which packages are reproducible, and thus more trustworthy.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="trustix---a-new-model-for-nix-binary-substitutions"><a class="header" href="#trustix---a-new-model-for-nix-binary-substitutions">Trustix - A new model for Nix binary substitutions</a></h1>
<p>Trustix is a tool that compares build outputs for a given build input across a group of independent providers to establish trust in software binaries.</p>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>We often use pre-built software binaries and trust that they correspond to the program we want.
But nothing assures that these binaries were really built from the program's sources and reasonable built instructions.
Common, costly supply chain attacks exploit this to distribute malicious software, which is one reason why most software is delivered through centralized, highly secured providers.
Trustix, a tool developed via an <a href="https://nlnet.nl/project/Trustix/">NGI0 PET grant</a>, establishes trust in binaries in a different, decentralized manner.
This increases security, and paves the way for an internet where small providers can deliver safe code, ultimately with a safer and larger offer for the user.</p>
<p>Trustix is developed for the Nix ecosystem.</p>
<h2 id="how-does-this-translate-to-nix"><a class="header" href="#how-does-this-translate-to-nix">How does this translate to Nix?</a></h2>
<p>In the Nix ecosystem, pre-built binaries are distributed through so-called <em>binary substituters</em>.
Similar to other centralized caching systems, they are a single point of failure in the chain of trust when delivering a package to a user.
This is problematic for several reasons:</p>
<p>First, if anyone manages to compromise the <a href="https://hydra.nixos.org/">NixOS Hydra</a> build machines and its keys, they could upload backdoored builds to users.
In the Nix ecosystem, a compromised key is even more dangerous because https://cache.nixos.org can't use a rolling key because of the way it is set up.
This means that a compromised key would realistically mean that <em>all</em> packages in the cache are compromised.
They would have to be rebuilt or garbage collected which is very costly.</p>
<p>Second, the NixOS Hydra <em>hardware</em>, on which the binaries are built, may also be compromised and not considered trustworthy by more security conscious users.</p>
<h2 id="trustix-design"><a class="header" href="#trustix-design">Trustix design</a></h2>
<p><code>Trustix</code> aims to solve this problem via distributed trust &amp; trust agility.
Essentially it compares build outputs across a group of independent builders
that log and exchange hashes of build input/output pairs.
This is achieved through the following methodology:</p>
<ul>
<li>Each builder is associated with a public-private key pair</li>
<li>In a post-build hook the output hash (NAR hash) of the build is uploaded to a ledger</li>
</ul>
<p>This allows a user to trust binary substitutions based on an M-of-N vote among the participating builders.</p>
<p>Here is an example:
Let's say we have 4 builders configured: <code>Alice</code>, <code>Bob</code>, <code>Chuck</code> &amp; <code>Dan</code>.
We have configured <code>Trustix</code> to require a 3/4 majority for a build to be trusted.
<code>Alice</code>, <code>Bob</code>, <code>Dan</code> and <code>Chuck</code> all claim to have built the <code>hello</code> derivation.
All builders participate in the Trustix network and communicate precisely
what they have built with a hash that describes the build inputs of <code>hello</code>, and
what have obtained as output with another hash.
For the same input, the first 3 builders have arrived at the same output hash but <code>Chuck</code> has
obtained something different.</p>
<p>This information can now be used by a Trustix user to:</p>
<ul>
<li>track build reproducability across a large number of builders.</li>
<li>trust only builds that have been confirmed by a majority of selected
builders.</li>
<li>automatically identify and exclude misbehaving builders such as <code>Chuck</code> in
above's example.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="trustix---end-to-end-nix-howtos"><a class="header" href="#trustix---end-to-end-nix-howtos">Trustix - End to end Nix howto's</a></h1>
<p>Up until now we have talked about components in isolation, let's go through some practical examples of how to deploy your own Trustix nodes.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="trustix---usage-via-nix"><a class="header" href="#trustix---usage-via-nix">Trustix - Usage via Nix</a></h1>
<p>The easiest way to use Trustix is via the NixOS modules, though even they require some manual preparation in terms of generating keys.</p>
<p>This document will guide you through the very basic NixOS setup required both by log clients and log publishers.</p>
<p>How to actually publish/subscribe are laid out in other documents.</p>
<h2 id="requisites"><a class="header" href="#requisites">Requisites</a></h2>
<ul>
<li>A NixOS installation (flakes based optional)</li>
</ul>
<h2 id="strategies"><a class="header" href="#strategies">Strategies</a></h2>
<h3 id="classical-nix"><a class="header" href="#classical-nix">Classical Nix</a></h3>
<p>It's highly recommended to use some automated tool like <a href="https://github.com/nmattia/niv">niv</a> to ensure you are up to date with your external dependencies, here we'll show you how to integrate Trustix in your NixOS configuration <em>manually</em> using no external tooling.</p>
<p>From within your configuration directory, clone Trustix:</p>
<pre><code class="language-sh">$ git clone https://github.com/nix-community/trustix.git
</code></pre>
<p>And add it to your NixOS configuration like:</p>
<pre><code>{ config, pkgs, lib, ... }:
{
  imports = [ ./trustix/nixos ];
}
</code></pre>
<h3 id="flakes"><a class="header" href="#flakes">Flakes</a></h3>
<p>This is a minimal <code>flake.nix</code> for using Trustix with Flakes:</p>
<pre><code>
{
  inputs = {
    nixpkgs.url = &quot;github:NixOS/nixpkgs/nixos-unstable&quot;;
    flake-utils.url = &quot;github:numtide/flake-utils&quot;;

    trustix = {
      url = &quot;github:nix-community/trustix&quot;;
      inputs.nixpkgs.follows = &quot;nixpkgs&quot;;
    };
  };
  outputs = { nixpkgs, flake-utils, trustix, ... }: {

    nixosConfigurations.trustix-example = nixpkgs.lib.nixosSystem {
      system = &quot;x86_64-linux&quot;;
      modules =
        [ ({ pkgs, ... }: {
            # import trustix modules
            imports = [ trustix.nixosModules.trustix ];
          })
        ];
    };

  };
}
</code></pre>
<h2 id="effect"><a class="header" href="#effect">Effect</a></h2>
<p>This will add all relevant services to your system (but not enable them) and adds packages to the pkgs set via an overlay.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="trustix---builder-setup-with-colmena-flake-based"><a class="header" href="#trustix---builder-setup-with-colmena-flake-based">Trustix - Builder setup with Colmena (flake based)</a></h1>
<p>Up until now we have talked about components in isolation, let's take a stab at a real deployment using <a href="https://github.com/zhaofengli/colmena">Colmena</a>.
Once we're done we will have:</p>
<ul>
<li>A Trustix instance that others can subscribe to</li>
<li>A local post build hook that publishes builds</li>
</ul>
<p>Most of the contents in this article will be applicable to other deployment systems too with only minimal changes, the biggest difference should be how they deal with key material (secrets).</p>
<h2 id="requisites--assumptions"><a class="header" href="#requisites--assumptions">Requisites / assumptions</a></h2>
<ul>
<li>You need a recent Nix with Flakes enabled</li>
<li>We start off in an empty git repository</li>
<li>Our domain name is <code>demo.trustix.dev</code></li>
</ul>
<h2 id="create-keys"><a class="header" href="#create-keys">Create keys</a></h2>
<p>All Trustix build logs are first and foremost identified by their key pair, which will be the first thing we have to generate.</p>
<p>Let's start by generating a key pair for our log:</p>
<pre><code>$ mkdir secrets
$ nix run github:nix-community/trustix#trustix -- generate-key --privkey secrets/log-priv --pubkey secrets/log-pub
</code></pre>
<p>Additionally logs are identified not just by their key, but how that key is used.
If a key is used for multiple protocols (not just Nix) those logs will have a different ID.
This ID is what <em>subscribers</em> use to indicate what they want to subscribe to.</p>
<p>To find out the log ID for the key pair you just generated:
<code>$ nix run github:nix-community/trustix#trustix -- print-log-id --protocol nix --pubkey $(cat secrets/log-pub)</code></p>
<h2 id="create-a-deployment"><a class="header" href="#create-a-deployment">Create a deployment</a></h2>
<p>In your <code>flake.nix</code> put:</p>
<pre><code class="language-nix">{
  inputs = {
    nixpkgs.url = &quot;github:NixOS/nixpkgs/nixos-unstable&quot;;
    flake-utils.url = &quot;github:numtide/flake-utils&quot;;

    trustix = {
      url = &quot;github:nix-community/trustix&quot;;
      inputs.nixpkgs.follows = &quot;nixpkgs&quot;;
    };
  };
  outputs = { nixpkgs, flake-utils, trustix, ... }:
    let
      hostName = &quot;demo.trustix.dev&quot;;
    in

    # Provide colmena
    (flake-utils.lib.eachDefaultSystem
      (system:
        let
          pkgs = nixpkgs.legacyPackages.${system};
        in
        {
          devShells.default = pkgs.mkShell {
            packages = [ pkgs.colmena ];
          };
        })
    ) // {

      # Our actual deployment
      colmena = {
        meta = {
          nixpkgs = import nixpkgs {
            system = &quot;x86_64-linux&quot;;
            # Note that the overlay has to be applied manually when using Colmena
            overlays = [ trustix.overlays.default ];
          };
        };

        # Import the Trustix NixOS modules on all machines
        defaults = { pkgs, ... }: {
          imports = [
            trustix.nixosModules.trustix
          ];
        };

        &quot;${hostName}&quot; = {

          # Main Trustix daemon configuration
          services.trustix = {
            enable = true;

            # Signers &amp; publishers are separate concepts as the same key
            # could potentially be used to publish multiple logs under different Trustix subprotocols.
            #
            # If you don't know what this means: While Trustix is build for Nix first, the core can be used for other ecosystems too, not just Nix.
            signers.my-signer = {
              type = &quot;ed25519&quot;;
              ed25519.private-key-path = &quot;/var/lib/my-trustix-key&quot;;
            };

            publishers = [
              {
                signer = &quot;my-signer&quot;; # Use the key configured above
                protocol = &quot;nix&quot;; # This publisher is using the Nix subprotocol

                # An arbitrary (string -&gt; string) attrset with metadata about this log
                meta = {
                  upstream = &quot;https://cache.nixos.org&quot;;
                };

                publicKey = {
                  type = &quot;ed25519&quot;;
                  key = builtins.readFile ./secrets/log-pub;
                };
              }
            ];

          };

          # Enable the post build hook to push builds to the main Trustix daemon
          services.trustix-nix-build-hook = {
            enable = true;
            # The logID we got earlier
            logID = &quot;453016597475f45532e0a22a448ea7e0fb915e950d3c8930bfd23d962d73f9c1&quot;;
          };

          deployment = {
            targetHost = hostName;
            targetUser = &quot;root&quot;;

            # We are using the Colmena secrets facility to upload the keys to the remote
            # without ending up world readable in the Nix store.
            keys = {
              my-trustix-key = {
                keyFile = ./secrets/log-priv;

                # This mode is too open for a real world deployment but we don't want to deal
                # with the complexities of secrets management here.
                permissions = &quot;0644&quot;;
                destDir = &quot;/var/lib&quot;;
              };
            };

          };
        };
      };
    };
}
</code></pre>
<p>Enter the development shell and deploy:</p>
<pre><code>$ nix develop  # Pulls in Colmena via Flakes devShells
$ colmena apply  # Deploy
</code></pre>
<h2 id="test-the-builder"><a class="header" href="#test-the-builder">Test the builder</a></h2>
<p>With this simple Nix build, you can test on the builder system if the trustix post-build-hook is run and can connect to the trustix deamon.</p>
<pre><code>[user@nixos:~]$ nix-build '&lt;nixpkgs&gt;' -A hello --no-out-link --check
...
running post-build-hook '/nix/store/xqq4fmks5ws1x4nmg27yhv1vq0l5w7mm-trustix-hook'...
post-build-hook: time=&quot;2022-12-07T04:09:36+01:00&quot; level=debug msg=&quot;Submitting mapping&quot; storePath=/nix/store/4m1jlh4n5s9wzc802baj4slncmg826vz-hello-2.12
post-build-hook: time=&quot;2022-12-07T04:09:36+01:00&quot; level=debug msg=&quot;Dialing remote&quot; address=&quot;unix:///run/trustix-daemon.socket&quot;
/nix/store/4m1jlh4n5s9wzc802baj4slncmg826vz-hello-2.12
</code></pre>
<h2 id="spread-your-log"><a class="header" href="#spread-your-log">Spread your log</a></h2>
<p>In the next chapter we will go over how to use this log from clients.
The most important thing right now is to make a note of your <em>public</em> key and your <em>domain name</em>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="trustix---subscribing"><a class="header" href="#trustix---subscribing">Trustix - Subscribing</a></h1>
<p>This document walks you through how to subscribe to an already published binary cache.</p>
<h2 id="requisites-1"><a class="header" href="#requisites-1">Requisites</a></h2>
<ul>
<li>A local Trustix instance</li>
<li>A remote log's metadata
<ul>
<li>Public key</li>
<li>URL</li>
</ul>
</li>
</ul>
<h2 id="configuring"><a class="header" href="#configuring">Configuring</a></h2>
<ul>
<li>Add log(s) to your <code>configuration.nix</code></li>
</ul>
<pre><code class="language-nix">{ pkgs, config, ... }:
{

  services.trustix = {
    enable = true;

    subscribers = [
      {
        protocol = &quot;nix&quot;;
        publicKey = {
          type = &quot;ed25519&quot;;
          key = &quot;2uy8gNIOYEewTiV7iB7cUxBGpXxQtdlFepFoRvJTCJo=&quot;;
        };
      }
    ];

    # A remote can expose many logs and they are not neccesarily created by the remote in question
    remotes = [
      &quot;https://demo.trustix.dev&quot;
    ];

  };

}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="trustix---binary-cache-setup"><a class="header" href="#trustix---binary-cache-setup">Trustix - Binary cache setup</a></h1>
<p>The easiest way to use Trustix is via the NixOS modules, though even they require some manual preparation in terms of generating keys.</p>
<p>This document walks you through how to configure your local system as a binary cache.</p>
<h2 id="requisites-2"><a class="header" href="#requisites-2">Requisites</a></h2>
<p>We are assuming you have already followed the steps to set up one or more subscribers to your local Trustix instance.</p>
<ul>
<li>Generate a public/private keypair to use with your local binary cache.</li>
</ul>
<pre><code class="language-sh">$ nix-store --generate-binary-cache-key binarycache.example.com cache-priv-key.pem cache-pub-key.pem
</code></pre>
<ul>
<li>Move the keys somewhere persistent and safe
Of course having keys around readable by anyone on the system is not a good idea, so we will move these somewhere safe.
In this tutorial we are using <code>/var/trustix/keys</code> but you are free to use whatever you wish.
A deployment tool like Colmena, Morph or NixOps is recommended to deal with secrets.</li>
</ul>
<p><code>$ mv cache-priv-key.pem /var/trustix/keys/cache-priv-key.pem</code></p>
<h2 id="configuring-1"><a class="header" href="#configuring-1">Configuring</a></h2>
<ul>
<li>Add the binary cache to your <code>configuration.nix</code></li>
</ul>
<pre><code class="language-nix">{ pkgs, config, ... }:
{

  # Enable the local binary cache server
  services.trustix-nix-cache = {
    enable = true;
    private-key = &quot;/var/trustix/keys/cache-priv-key.pem&quot;;
    port = 9001;
  };

  # Configure Nix to use it
  nix = {
    binaryCaches = [
      &quot;http://localhost:9001&quot;
    ];
    binaryCachePublicKeys = [
      &quot;binarycache.example.com://06YZJreoL8n9IdDlhnA3t7uJmHUI/rIIy3uO4FHRY=&quot;
    ];
  };

  # Configure your Trustix daemon with a decision making process on how
  # to determine if a build is trustworthy or not.
  #
  # In this case we configure it to have at least 2/3 majority to be substituted.
  #
  # Note that this configuration is incomplete and assumes you have already set up a subscriber.
  services.trustix = {
    deciders.nix = [
      {
        engine = &quot;percentage&quot;;
        percentage.minimum = 66;
      }
    ];
  };

}
</code></pre>
<p>You are now all set up to use Trustix as a substitution method!</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="project-structure"><a class="header" href="#project-structure">Project structure</a></h2>
<p>Trustix is structured as a monorepo consisting of many subpackages:</p>
<ul>
<li><a href="https://github.com/nix-community/trustix/blob/master/packages/trustix">trustix</a></li>
</ul>
<p>The main package with all log functionality.
This component is generic and doesn't know anything about any Nix or other package manager specifics.</p>
<ul>
<li><a href="https://github.com/nix-community/trustix/blob/master/packages/trustix-doc">trustix-doc</a></li>
</ul>
<p>The main documentation package that aggregates documentation from the various subpackages.</p>
<ul>
<li><a href="https://github.com/nix-community/trustix/blob/master/packages/trustix-nix">trustix-nix</a></li>
</ul>
<p>This is a supplemental daemon to the main Trustix daemon that layers some knowledge about Nix on top of the generic log functionality.
It contains a <a href="https://www.tweag.io/blog/2019-11-21-untrusted-ci/">post-build hook</a> used to submit newly built packages to the logs, a binary cache HTTP interface and a development tool to submit already built closures.</p>
<ul>
<li><a href="https://github.com/nix-community/trustix/blob/master/packages/trustix-nix-r13y">trustix-nix-r13y</a></li>
</ul>
<p>This package is an implementation of a reproducibility tracker backed by logs.</p>
<ul>
<li><a href="https://github.com/nix-community/trustix/blob/master/packages/trustix-proto">trustix-proto</a></li>
</ul>
<p>Trustix-proto contains all shared protobuf definitions shared by various components, as well as generated Go libraries to interact with Trustix over it's RPC mechanism (gRPC).</p>
<h2 id="globally-installed-tooling"><a class="header" href="#globally-installed-tooling">Globally installed tooling</a></h2>
<p>Trustix doesn't depend on much in the way of globally installed tools.</p>
<p>We do make two assumptions in regards to tooling managed outside of the repository though:</p>
<ul>
<li><a href="https://nixos.org">Nix</a></li>
</ul>
<p>If you've read this far you likely already know Nix and what it is, so we won't go into any detail about this.</p>
<ul>
<li><a href="https://direnv.net">direnv</a></li>
</ul>
<p>A shell extension to load directory local environments in a currently running shell and/or editor.
This will load a present <code>shell.nix</code>/<code>default.nix</code> when used with the direnv rule <code>use nix</code>, which is the mode of operation we are using direnv in.</p>
<h2 id="getting-started"><a class="header" href="#getting-started">Getting started</a></h2>
<p>All subpackages have their own shell environments which all needs to be explicitly whitelisted to be loaded.
For convenience we have a Makefile target in the root of the project called <code>direnv-allow</code>.
To whitelist all subpackages run:</p>
<pre><code class="language-sh">$ make direnv-allow
</code></pre>
<h2 id="makefile-structure"><a class="header" href="#makefile-structure">Makefile structure</a></h2>
<p>All components are using Makefile's as their development entry points for ease of use.</p>
<p>All standard Make targets are always implemented, even though they are no-ops in some cases where they don't make sense.
For example a build step doesn't make sense for most Python code.</p>
<p>These are all standard make targets you can expect to find for any given package:</p>
<ul>
<li>build</li>
</ul>
<p>Builds the package.</p>
<ul>
<li>test</li>
</ul>
<p>Runs the tests for a given package.</p>
<ul>
<li>lint</li>
</ul>
<p>This target runs all configured linter steps.</p>
<ul>
<li>format</li>
</ul>
<p>This target checks the formatting of a given package.</p>
<ul>
<li>develop</li>
</ul>
<p>This target runs the package in development (watch) mode.</p>
<ul>
<li>doc</li>
</ul>
<p>This target builds documentation.
This is mostly outputing markdown files in the relevant location for the <code>trustix-doc</code> package to compose.</p>
<h2 id="running-the-whole-setup"><a class="header" href="#running-the-whole-setup">Running the whole setup</a></h2>
<p>To run individual components change directory to the relevant package and run:</p>
<pre><code class="language-sh">$ make develop
</code></pre>
<p>This also works from the project root where it will start <em>all</em> packages in watch mode.</p>
<h2 id="quickly-runing-all-tests"><a class="header" href="#quickly-runing-all-tests">Quickly runing all tests</a></h2>
<p>From the root directory run:</p>
<pre><code class="language-sh">$ make all
</code></pre>
<h2 id="notes"><a class="header" href="#notes">Notes</a></h2>
<p>Cryptographic keys for development is checked in to the repository for ease of use and a very quick getting started experience.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="protocol-documentation"><a class="header" href="#protocol-documentation">Protocol Documentation</a></h1>
<p><a name="top"></a></p>
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h2>
<ul>
<li>
<p><a href="api.html#api_api-proto">api/api.proto</a></p>
<ul>
<li>
<p><a href="api.html#trustix_api-v1-GetLogAuditProofRequest">GetLogAuditProofRequest</a></p>
</li>
<li>
<p><a href="api.html#trustix_api-v1-GetLogConsistencyProofRequest">GetLogConsistencyProofRequest</a></p>
</li>
<li>
<p><a href="api.html#trustix_api-v1-GetLogEntriesRequest">GetLogEntriesRequest</a></p>
</li>
<li>
<p><a href="api.html#trustix_api-v1-GetMapValueRequest">GetMapValueRequest</a></p>
</li>
<li>
<p><a href="api.html#trustix_api-v1-KeyValuePair">KeyValuePair</a></p>
</li>
<li>
<p><a href="api.html#trustix_api-v1-Log">Log</a></p>
</li>
<li>
<p><a href="api.html#trustix_api-v1-Log-MetaEntry">Log.MetaEntry</a></p>
</li>
<li>
<p><a href="api.html#trustix_api-v1-LogEntriesResponse">LogEntriesResponse</a></p>
</li>
<li>
<p><a href="api.html#trustix_api-v1-LogHeadRequest">LogHeadRequest</a></p>
</li>
<li>
<p><a href="api.html#trustix_api-v1-LogSigner">LogSigner</a></p>
</li>
<li>
<p><a href="api.html#trustix_api-v1-LogsRequest">LogsRequest</a></p>
</li>
<li>
<p><a href="api.html#trustix_api-v1-LogsResponse">LogsResponse</a></p>
</li>
<li>
<p><a href="api.html#trustix_api-v1-MapValueResponse">MapValueResponse</a></p>
</li>
<li>
<p><a href="api.html#trustix_api-v1-ProofResponse">ProofResponse</a></p>
</li>
<li>
<p><a href="api.html#trustix_api-v1-SparseCompactMerkleProof">SparseCompactMerkleProof</a></p>
</li>
<li>
<p><a href="api.html#trustix_api-v1-ValueRequest">ValueRequest</a></p>
</li>
<li>
<p><a href="api.html#trustix_api-v1-ValueResponse">ValueResponse</a></p>
</li>
<li>
<p><a href="api.html#trustix_api-v1-Log-LogModes">Log.LogModes</a></p>
</li>
<li>
<p><a href="api.html#trustix_api-v1-LogSigner-KeyTypes">LogSigner.KeyTypes</a></p>
</li>
<li>
<p><a href="api.html#trustix_api-v1-LogAPI">LogAPI</a></p>
</li>
<li>
<p><a href="api.html#trustix_api-v1-NodeAPI">NodeAPI</a></p>
</li>
</ul>
</li>
<li>
<p><a href="api.html#rpc_rpc-proto">rpc/rpc.proto</a></p>
<ul>
<li>
<p><a href="api.html#trustix_rpc-v1-DecideRequest">DecideRequest</a></p>
</li>
<li>
<p><a href="api.html#trustix_rpc-v1-DecisionResponse">DecisionResponse</a></p>
</li>
<li>
<p><a href="api.html#trustix_rpc-v1-EntriesResponse">EntriesResponse</a></p>
</li>
<li>
<p><a href="api.html#trustix_rpc-v1-EntriesResponse-EntriesEntry">EntriesResponse.EntriesEntry</a></p>
</li>
<li>
<p><a href="api.html#trustix_rpc-v1-FlushRequest">FlushRequest</a></p>
</li>
<li>
<p><a href="api.html#trustix_rpc-v1-FlushResponse">FlushResponse</a></p>
</li>
<li>
<p><a href="api.html#trustix_rpc-v1-LogValueDecision">LogValueDecision</a></p>
</li>
<li>
<p><a href="api.html#trustix_rpc-v1-LogValueResponse">LogValueResponse</a></p>
</li>
<li>
<p><a href="api.html#trustix_rpc-v1-SubmitRequest">SubmitRequest</a></p>
</li>
<li>
<p><a href="api.html#trustix_rpc-v1-SubmitResponse">SubmitResponse</a></p>
</li>
<li>
<p><a href="api.html#trustix_rpc-v1-SubmitResponse-Status">SubmitResponse.Status</a></p>
</li>
<li>
<p><a href="api.html#trustix_rpc-v1-LogRPC">LogRPC</a></p>
</li>
<li>
<p><a href="api.html#trustix_rpc-v1-RPCApi">RPCApi</a></p>
</li>
</ul>
</li>
<li>
<p><a href="api.html#schema_loghead-proto">schema/loghead.proto</a></p>
<ul>
<li><a href="api.html#trustix_schema-v1-LogHead">LogHead</a></li>
</ul>
</li>
<li>
<p><a href="api.html#schema_logleaf-proto">schema/logleaf.proto</a></p>
<ul>
<li><a href="api.html#trustix_schema-v1-LogLeaf">LogLeaf</a></li>
</ul>
</li>
<li>
<p><a href="api.html#schema_mapentry-proto">schema/mapentry.proto</a></p>
<ul>
<li><a href="api.html#trustix_schema-v1-MapEntry">MapEntry</a></li>
</ul>
</li>
<li>
<p><a href="api.html#schema_queue-proto">schema/queue.proto</a></p>
<ul>
<li><a href="api.html#trustix_schema-v1-SubmitQueue">SubmitQueue</a></li>
</ul>
</li>
<li>
<p><a href="api.html#scalar-value-types">Scalar Value Types</a></p>
</li>
</ul>
<p><a name="api_api-proto"></a></p>
<p align="right"><a href="api.html#top">Top</a></p>
<h2 id="apiapiproto"><a class="header" href="#apiapiproto">api/api.proto</a></h2>
<p><a name="trustix_api-v1-GetLogAuditProofRequest"></a></p>
<h3 id="getlogauditproofrequest"><a class="header" href="#getlogauditproofrequest">GetLogAuditProofRequest</a></h3>
<p>Get log audit proof for a given tree</p>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>LogID</td><td><a href="api.html#string">string</a></td><td>required</td><td>Log identifier</td></tr>
<tr><td>Index</td><td><a href="api.html#uint64">uint64</a></td><td>required</td><td>Tree node index</td></tr>
<tr><td>TreeSize</td><td><a href="api.html#uint64">uint64</a></td><td>required</td><td>Tree size (proof reference)</td></tr>
</tbody></table>
</div>
<p><a name="trustix_api-v1-GetLogConsistencyProofRequest"></a></p>
<h3 id="getlogconsistencyproofrequest"><a class="header" href="#getlogconsistencyproofrequest">GetLogConsistencyProofRequest</a></h3>
<p>Get a consistency proof between two given log sizes</p>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>LogID</td><td><a href="api.html#string">string</a></td><td>required</td><td>Log identifier</td></tr>
<tr><td>FirstSize</td><td><a href="api.html#uint64">uint64</a></td><td>required</td><td>From tree size</td></tr>
<tr><td>SecondSize</td><td><a href="api.html#uint64">uint64</a></td><td>required</td><td>To tree size</td></tr>
</tbody></table>
</div>
<p><a name="trustix_api-v1-GetLogEntriesRequest"></a></p>
<h3 id="getlogentriesrequest"><a class="header" href="#getlogentriesrequest">GetLogEntriesRequest</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>LogID</td><td><a href="api.html#string">string</a></td><td>required</td><td>Log identifier</td></tr>
<tr><td>Start</td><td><a href="api.html#uint64">uint64</a></td><td>required</td><td>Get entries from</td></tr>
<tr><td>Finish</td><td><a href="api.html#uint64">uint64</a></td><td>required</td><td>Get entries to</td></tr>
</tbody></table>
</div>
<p><a name="trustix_api-v1-GetMapValueRequest"></a></p>
<h3 id="getmapvaluerequest"><a class="header" href="#getmapvaluerequest">GetMapValueRequest</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>LogID</td><td><a href="api.html#string">string</a></td><td>required</td><td>Log identifier</td></tr>
<tr><td>Key</td><td><a href="api.html#bytes">bytes</a></td><td>required</td><td>Map key</td></tr>
<tr><td>MapRoot</td><td><a href="api.html#bytes">bytes</a></td><td>required</td><td>Map root hash to derive proof from</td></tr>
</tbody></table>
</div>
<p><a name="trustix_api-v1-KeyValuePair"></a></p>
<h3 id="keyvaluepair"><a class="header" href="#keyvaluepair">KeyValuePair</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>Key</td><td><a href="api.html#bytes">bytes</a></td><td>required</td><td>Map key</td></tr>
<tr><td>Value</td><td><a href="api.html#bytes">bytes</a></td><td>required</td><td>Map value</td></tr>
</tbody></table>
</div>
<p><a name="trustix_api-v1-Log"></a></p>
<h3 id="log"><a class="header" href="#log">Log</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>LogID</td><td><a href="api.html#string">string</a></td><td>required</td><td></td></tr>
<tr><td>Mode</td><td><a href="api.html#trustix_api-v1-Log-LogModes">Log.LogModes</a></td><td>required</td><td></td></tr>
<tr><td>Protocol</td><td><a href="api.html#string">string</a></td><td>required</td><td></td></tr>
<tr><td>Signer</td><td><a href="api.html#trustix_api-v1-LogSigner">LogSigner</a></td><td>required</td><td></td></tr>
<tr><td>Meta</td><td><a href="api.html#trustix_api-v1-Log-MetaEntry">Log.MetaEntry</a></td><td>repeated</td><td></td></tr>
</tbody></table>
</div>
<p><a name="trustix_api-v1-Log-MetaEntry"></a></p>
<h3 id="logmetaentry"><a class="header" href="#logmetaentry">Log.MetaEntry</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>key</td><td><a href="api.html#string">string</a></td><td>optional</td><td></td></tr>
<tr><td>value</td><td><a href="api.html#string">string</a></td><td>optional</td><td></td></tr>
</tbody></table>
</div>
<p><a name="trustix_api-v1-LogEntriesResponse"></a></p>
<h3 id="logentriesresponse"><a class="header" href="#logentriesresponse">LogEntriesResponse</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>Leaves</td><td><a href="api.html#trustix_schema-v1-LogLeaf">trustix_schema.v1.LogLeaf</a></td><td>repeated</td><td></td></tr>
</tbody></table>
</div>
<p><a name="trustix_api-v1-LogHeadRequest"></a></p>
<h3 id="logheadrequest"><a class="header" href="#logheadrequest">LogHeadRequest</a></h3>
<p>Request a signed head for a given log</p>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>LogID</td><td><a href="api.html#string">string</a></td><td>required</td><td>Log identifier</td></tr>
</tbody></table>
</div>
<p><a name="trustix_api-v1-LogSigner"></a></p>
<h3 id="logsigner"><a class="header" href="#logsigner">LogSigner</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>KeyType</td><td><a href="api.html#trustix_api-v1-LogSigner-KeyTypes">LogSigner.KeyTypes</a></td><td>required</td><td></td></tr>
<tr><td>Public</td><td><a href="api.html#string">string</a></td><td>required</td><td></td></tr>
</tbody></table>
</div>
<p><a name="trustix_api-v1-LogsRequest"></a></p>
<h3 id="logsrequest"><a class="header" href="#logsrequest">LogsRequest</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>Protocols</td><td><a href="api.html#string">string</a></td><td>repeated</td><td>Allow to filter logs response based on the protocol identifier</td></tr>
</tbody></table>
</div>
<p><a name="trustix_api-v1-LogsResponse"></a></p>
<h3 id="logsresponse"><a class="header" href="#logsresponse">LogsResponse</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>Logs</td><td><a href="api.html#trustix_api-v1-Log">Log</a></td><td>repeated</td><td></td></tr>
</tbody></table>
</div>
<p><a name="trustix_api-v1-MapValueResponse"></a></p>
<h3 id="mapvalueresponse"><a class="header" href="#mapvalueresponse">MapValueResponse</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>Value</td><td><a href="api.html#bytes">bytes</a></td><td>required</td><td>Note that the Value field is actually a MapEntry but we need to return the marshaled version as that's what the proof is created from</td></tr>
<tr><td>Proof</td><td><a href="api.html#trustix_api-v1-SparseCompactMerkleProof">SparseCompactMerkleProof</a></td><td>required</td><td></td></tr>
</tbody></table>
</div>
<p><a name="trustix_api-v1-ProofResponse"></a></p>
<h3 id="proofresponse"><a class="header" href="#proofresponse">ProofResponse</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>Proof</td><td><a href="api.html#bytes">bytes</a></td><td>repeated</td><td></td></tr>
</tbody></table>
</div>
<p><a name="trustix_api-v1-SparseCompactMerkleProof"></a></p>
<h3 id="sparsecompactmerkleproof"><a class="header" href="#sparsecompactmerkleproof">SparseCompactMerkleProof</a></h3>
<p>Sparse merkle tree proof</p>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>SideNodes</td><td><a href="api.html#bytes">bytes</a></td><td>repeated</td><td></td></tr>
<tr><td>NonMembershipLeafData</td><td><a href="api.html#bytes">bytes</a></td><td>optional</td><td></td></tr>
<tr><td>BitMask</td><td><a href="api.html#bytes">bytes</a></td><td>required</td><td></td></tr>
<tr><td>NumSideNodes</td><td><a href="api.html#uint64">uint64</a></td><td>required</td><td></td></tr>
</tbody></table>
</div>
<p><a name="trustix_api-v1-ValueRequest"></a></p>
<h3 id="valuerequest"><a class="header" href="#valuerequest">ValueRequest</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>Digest</td><td><a href="api.html#bytes">bytes</a></td><td>required</td><td></td></tr>
</tbody></table>
</div>
<p><a name="trustix_api-v1-ValueResponse"></a></p>
<h3 id="valueresponse"><a class="header" href="#valueresponse">ValueResponse</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>Value</td><td><a href="api.html#bytes">bytes</a></td><td>required</td><td></td></tr>
</tbody></table>
</div>
<p><a name="trustix_api-v1-Log-LogModes"></a></p>
<h3 id="loglogmodes"><a class="header" href="#loglogmodes">Log.LogModes</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Number</th><th>Description</th></tr></thead><tbody>
<tr><td>Log</td><td>0</td><td></td></tr>
</tbody></table>
</div>
<p><a name="trustix_api-v1-LogSigner-KeyTypes"></a></p>
<h3 id="logsignerkeytypes"><a class="header" href="#logsignerkeytypes">LogSigner.KeyTypes</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Number</th><th>Description</th></tr></thead><tbody>
<tr><td>ed25519</td><td>0</td><td></td></tr>
</tbody></table>
</div>
<p><a name="trustix_api-v1-LogAPI"></a></p>
<h3 id="logapi"><a class="header" href="#logapi">LogAPI</a></h3>
<p>LogAPI is a logical grouping for RPC methods that are specific to a given
log.</p>
<div class="table-wrapper"><table><thead><tr><th>Method Name</th><th>Request Type</th><th>Response Type</th><th>Description</th></tr></thead><tbody>
<tr><td>GetHead</td><td><a href="api.html#trustix_api-v1-LogHeadRequest">LogHeadRequest</a></td><td><a href="api.html#trustix_schema-v1-LogHead">.trustix_schema.v1.LogHead</a></td><td>Get signed head</td></tr>
<tr><td>GetLogConsistencyProof</td><td><a href="api.html#trustix_api-v1-GetLogConsistencyProofRequest">GetLogConsistencyProofRequest</a></td><td><a href="api.html#trustix_api-v1-ProofResponse">ProofResponse</a></td><td></td></tr>
<tr><td>GetLogAuditProof</td><td><a href="api.html#trustix_api-v1-GetLogAuditProofRequest">GetLogAuditProofRequest</a></td><td><a href="api.html#trustix_api-v1-ProofResponse">ProofResponse</a></td><td></td></tr>
<tr><td>GetLogEntries</td><td><a href="api.html#trustix_api-v1-GetLogEntriesRequest">GetLogEntriesRequest</a></td><td><a href="api.html#trustix_api-v1-LogEntriesResponse">LogEntriesResponse</a></td><td></td></tr>
<tr><td>GetMapValue</td><td><a href="api.html#trustix_api-v1-GetMapValueRequest">GetMapValueRequest</a></td><td><a href="api.html#trustix_api-v1-MapValueResponse">MapValueResponse</a></td><td></td></tr>
<tr><td>GetMHLogConsistencyProof</td><td><a href="api.html#trustix_api-v1-GetLogConsistencyProofRequest">GetLogConsistencyProofRequest</a></td><td><a href="api.html#trustix_api-v1-ProofResponse">ProofResponse</a></td><td></td></tr>
<tr><td>GetMHLogAuditProof</td><td><a href="api.html#trustix_api-v1-GetLogAuditProofRequest">GetLogAuditProofRequest</a></td><td><a href="api.html#trustix_api-v1-ProofResponse">ProofResponse</a></td><td></td></tr>
<tr><td>GetMHLogEntries</td><td><a href="api.html#trustix_api-v1-GetLogEntriesRequest">GetLogEntriesRequest</a></td><td><a href="api.html#trustix_api-v1-LogEntriesResponse">LogEntriesResponse</a></td><td></td></tr>
</tbody></table>
</div>
<p><a name="trustix_api-v1-NodeAPI"></a></p>
<h3 id="nodeapi"><a class="header" href="#nodeapi">NodeAPI</a></h3>
<p>NodeAPI is a logical grouping for RPC methods that are for the entire node
rather than individual logs.</p>
<div class="table-wrapper"><table><thead><tr><th>Method Name</th><th>Request Type</th><th>Response Type</th><th>Description</th></tr></thead><tbody>
<tr><td>Logs</td><td><a href="api.html#trustix_api-v1-LogsRequest">LogsRequest</a></td><td><a href="api.html#trustix_api-v1-LogsResponse">LogsResponse</a></td><td>Get a list of all logs published by this node</td></tr>
<tr><td>GetValue</td><td><a href="api.html#trustix_api-v1-ValueRequest">ValueRequest</a></td><td><a href="api.html#trustix_api-v1-ValueResponse">ValueResponse</a></td><td>Get values by their content-address</td></tr>
</tbody></table>
</div>
<p><a name="rpc_rpc-proto"></a></p>
<p align="right"><a href="api.html#top">Top</a></p>
<h2 id="rpcrpcproto"><a class="header" href="#rpcrpcproto">rpc/rpc.proto</a></h2>
<p><a name="trustix_rpc-v1-DecideRequest"></a></p>
<h3 id="deciderequest"><a class="header" href="#deciderequest">DecideRequest</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>Key</td><td><a href="api.html#bytes">bytes</a></td><td>required</td><td></td></tr>
<tr><td>Protocol</td><td><a href="api.html#string">string</a></td><td>required</td><td></td></tr>
</tbody></table>
</div>
<p><a name="trustix_rpc-v1-DecisionResponse"></a></p>
<h3 id="decisionresponse"><a class="header" href="#decisionresponse">DecisionResponse</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>Decision</td><td><a href="api.html#trustix_rpc-v1-LogValueDecision">LogValueDecision</a></td><td>required</td><td></td></tr>
<tr><td>Mismatches</td><td><a href="api.html#trustix_rpc-v1-LogValueResponse">LogValueResponse</a></td><td>repeated</td><td>Non-matches (hash mismatch)</td></tr>
<tr><td>Misses</td><td><a href="api.html#string">string</a></td><td>repeated</td><td>Full misses (log ids missing log entry entirely)</td></tr>
</tbody></table>
</div>
<p><a name="trustix_rpc-v1-EntriesResponse"></a></p>
<h3 id="entriesresponse"><a class="header" href="#entriesresponse">EntriesResponse</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>Key</td><td><a href="api.html#bytes">bytes</a></td><td>required</td><td></td></tr>
<tr><td>Entries</td><td><a href="api.html#trustix_rpc-v1-EntriesResponse-EntriesEntry">EntriesResponse.EntriesEntry</a></td><td>repeated</td><td></td></tr>
</tbody></table>
</div>
<p><a name="trustix_rpc-v1-EntriesResponse-EntriesEntry"></a></p>
<h3 id="entriesresponseentriesentry"><a class="header" href="#entriesresponseentriesentry">EntriesResponse.EntriesEntry</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>key</td><td><a href="api.html#string">string</a></td><td>optional</td><td></td></tr>
<tr><td>value</td><td><a href="api.html#trustix_schema-v1-MapEntry">trustix_schema.v1.MapEntry</a></td><td>optional</td><td></td></tr>
</tbody></table>
</div>
<p><a name="trustix_rpc-v1-FlushRequest"></a></p>
<h3 id="flushrequest"><a class="header" href="#flushrequest">FlushRequest</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>LogID</td><td><a href="api.html#string">string</a></td><td>required</td><td></td></tr>
</tbody></table>
</div>
<p><a name="trustix_rpc-v1-FlushResponse"></a></p>
<h3 id="flushresponse"><a class="header" href="#flushresponse">FlushResponse</a></h3>
<p><a name="trustix_rpc-v1-LogValueDecision"></a></p>
<h3 id="logvaluedecision"><a class="header" href="#logvaluedecision">LogValueDecision</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>LogIDs</td><td><a href="api.html#string">string</a></td><td>repeated</td><td></td></tr>
<tr><td>Digest</td><td><a href="api.html#bytes">bytes</a></td><td>required</td><td></td></tr>
<tr><td>Confidence</td><td><a href="api.html#int32">int32</a></td><td>required</td><td></td></tr>
<tr><td>Value</td><td><a href="api.html#bytes">bytes</a></td><td>required</td><td></td></tr>
</tbody></table>
</div>
<p><a name="trustix_rpc-v1-LogValueResponse"></a></p>
<h3 id="logvalueresponse"><a class="header" href="#logvalueresponse">LogValueResponse</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>LogID</td><td><a href="api.html#string">string</a></td><td>required</td><td></td></tr>
<tr><td>Digest</td><td><a href="api.html#bytes">bytes</a></td><td>required</td><td></td></tr>
</tbody></table>
</div>
<p><a name="trustix_rpc-v1-SubmitRequest"></a></p>
<h3 id="submitrequest"><a class="header" href="#submitrequest">SubmitRequest</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>LogID</td><td><a href="api.html#string">string</a></td><td>required</td><td></td></tr>
<tr><td>Items</td><td><a href="api.html#trustix_api-v1-KeyValuePair">trustix_api.v1.KeyValuePair</a></td><td>repeated</td><td></td></tr>
</tbody></table>
</div>
<p><a name="trustix_rpc-v1-SubmitResponse"></a></p>
<h3 id="submitresponse"><a class="header" href="#submitresponse">SubmitResponse</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>status</td><td><a href="api.html#trustix_rpc-v1-SubmitResponse-Status">SubmitResponse.Status</a></td><td>required</td><td></td></tr>
</tbody></table>
</div>
<p><a name="trustix_rpc-v1-SubmitResponse-Status"></a></p>
<h3 id="submitresponsestatus"><a class="header" href="#submitresponsestatus">SubmitResponse.Status</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Number</th><th>Description</th></tr></thead><tbody>
<tr><td>OK</td><td>0</td><td></td></tr>
</tbody></table>
</div>
<p><a name="trustix_rpc-v1-LogRPC"></a></p>
<h3 id="logrpc"><a class="header" href="#logrpc">LogRPC</a></h3>
<p>RPCApi are &quot;private&quot; rpc methods for an instance related to a specific log.
This should only be available to trusted parties.</p>
<div class="table-wrapper"><table><thead><tr><th>Method Name</th><th>Request Type</th><th>Response Type</th><th>Description</th></tr></thead><tbody>
<tr><td>GetHead</td><td><a href="api.html#trustix_api-v1-LogHeadRequest">.trustix_api.v1.LogHeadRequest</a></td><td><a href="api.html#trustix_schema-v1-LogHead">.trustix_schema.v1.LogHead</a></td><td></td></tr>
<tr><td>GetLogEntries</td><td><a href="api.html#trustix_api-v1-GetLogEntriesRequest">.trustix_api.v1.GetLogEntriesRequest</a></td><td><a href="api.html#trustix_api-v1-LogEntriesResponse">.trustix_api.v1.LogEntriesResponse</a></td><td></td></tr>
<tr><td>Submit</td><td><a href="api.html#trustix_rpc-v1-SubmitRequest">SubmitRequest</a></td><td><a href="api.html#trustix_rpc-v1-SubmitResponse">SubmitResponse</a></td><td></td></tr>
<tr><td>Flush</td><td><a href="api.html#trustix_rpc-v1-FlushRequest">FlushRequest</a></td><td><a href="api.html#trustix_rpc-v1-FlushResponse">FlushResponse</a></td><td></td></tr>
</tbody></table>
</div>
<p><a name="trustix_rpc-v1-RPCApi"></a></p>
<h3 id="rpcapi"><a class="header" href="#rpcapi">RPCApi</a></h3>
<p>RPCApi are &quot;private&quot; rpc methods for an instance.
This should only be available to trusted parties.</p>
<div class="table-wrapper"><table><thead><tr><th>Method Name</th><th>Request Type</th><th>Response Type</th><th>Description</th></tr></thead><tbody>
<tr><td>Logs</td><td><a href="api.html#trustix_api-v1-LogsRequest">.trustix_api.v1.LogsRequest</a></td><td><a href="api.html#trustix_api-v1-LogsResponse">.trustix_api.v1.LogsResponse</a></td><td>Get a list of all logs published/subscribed by this node</td></tr>
<tr><td>Decide</td><td><a href="api.html#trustix_rpc-v1-DecideRequest">DecideRequest</a></td><td><a href="api.html#trustix_rpc-v1-DecisionResponse">DecisionResponse</a></td><td>Decide on an output for key based on the configured decision method</td></tr>
<tr><td>GetValue</td><td><a href="api.html#trustix_api-v1-ValueRequest">.trustix_api.v1.ValueRequest</a></td><td><a href="api.html#trustix_api-v1-ValueResponse">.trustix_api.v1.ValueResponse</a></td><td>Get values by their content-address</td></tr>
</tbody></table>
</div>
<p><a name="schema_loghead-proto"></a></p>
<p align="right"><a href="api.html#top">Top</a></p>
<h2 id="schemalogheadproto"><a class="header" href="#schemalogheadproto">schema/loghead.proto</a></h2>
<p><a name="trustix_schema-v1-LogHead"></a></p>
<h3 id="loghead"><a class="header" href="#loghead">LogHead</a></h3>
<p>Log</p>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>LogRoot</td><td><a href="api.html#bytes">bytes</a></td><td>required</td><td></td></tr>
<tr><td>TreeSize</td><td><a href="api.html#uint64">uint64</a></td><td>required</td><td></td></tr>
<tr><td>MapRoot</td><td><a href="api.html#bytes">bytes</a></td><td>required</td><td></td></tr>
<tr><td>MHRoot</td><td><a href="api.html#bytes">bytes</a></td><td>required</td><td></td></tr>
<tr><td>MHTreeSize</td><td><a href="api.html#uint64">uint64</a></td><td>required</td><td></td></tr>
<tr><td>Signature</td><td><a href="api.html#bytes">bytes</a></td><td>required</td><td>Aggregate signature</td></tr>
</tbody></table>
</div>
<p><a name="schema_logleaf-proto"></a></p>
<p align="right"><a href="api.html#top">Top</a></p>
<h2 id="schemalogleafproto"><a class="header" href="#schemalogleafproto">schema/logleaf.proto</a></h2>
<p><a name="trustix_schema-v1-LogLeaf"></a></p>
<h3 id="logleaf"><a class="header" href="#logleaf">LogLeaf</a></h3>
<p>Leaf value of a merkle tree</p>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>Key</td><td><a href="api.html#bytes">bytes</a></td><td>optional</td><td></td></tr>
<tr><td>ValueDigest</td><td><a href="api.html#bytes">bytes</a></td><td>optional</td><td></td></tr>
<tr><td>LeafDigest</td><td><a href="api.html#bytes">bytes</a></td><td>required</td><td></td></tr>
</tbody></table>
</div>
<p><a name="schema_mapentry-proto"></a></p>
<p align="right"><a href="api.html#top">Top</a></p>
<h2 id="schemamapentryproto"><a class="header" href="#schemamapentryproto">schema/mapentry.proto</a></h2>
<p><a name="trustix_schema-v1-MapEntry"></a></p>
<h3 id="mapentry"><a class="header" href="#mapentry">MapEntry</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>Digest</td><td><a href="api.html#bytes">bytes</a></td><td>required</td><td>Value digest of tree node</td></tr>
<tr><td>Index</td><td><a href="api.html#uint64">uint64</a></td><td>required</td><td>Index of value in log</td></tr>
</tbody></table>
</div>
<p><a name="schema_queue-proto"></a></p>
<p align="right"><a href="api.html#top">Top</a></p>
<h2 id="schemaqueueproto"><a class="header" href="#schemaqueueproto">schema/queue.proto</a></h2>
<p><a name="trustix_schema-v1-SubmitQueue"></a></p>
<h3 id="submitqueue"><a class="header" href="#submitqueue">SubmitQueue</a></h3>
<p>This type is internal only and not guaranteed stable</p>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td>Min</td><td><a href="api.html#uint64">uint64</a></td><td>required</td><td>Min is the <em>current</em> (last popped) ID</td></tr>
<tr><td>Max</td><td><a href="api.html#uint64">uint64</a></td><td>required</td><td>Max is the last written item</td></tr>
</tbody></table>
</div>
<h2 id="scalar-value-types"><a class="header" href="#scalar-value-types">Scalar Value Types</a></h2>
<div class="table-wrapper"><table><thead><tr><th>.proto Type</th><th>Notes</th><th>C++</th><th>Java</th><th>Python</th><th>Go</th><th>C#</th><th>PHP</th><th>Ruby</th></tr></thead><tbody>
<tr><td><a name="double" /> double</td><td></td><td>double</td><td>double</td><td>float</td><td>float64</td><td>double</td><td>float</td><td>Float</td></tr>
<tr><td><a name="float" /> float</td><td></td><td>float</td><td>float</td><td>float</td><td>float32</td><td>float</td><td>float</td><td>Float</td></tr>
<tr><td><a name="int32" /> int32</td><td>Uses variable-length encoding. Inefficient for encoding negative numbers  if your field is likely to have negative values, use sint32 instead.</td><td>int32</td><td>int</td><td>int</td><td>int32</td><td>int</td><td>integer</td><td>Bignum or Fixnum (as required)</td></tr>
<tr><td><a name="int64" /> int64</td><td>Uses variable-length encoding. Inefficient for encoding negative numbers  if your field is likely to have negative values, use sint64 instead.</td><td>int64</td><td>long</td><td>int/long</td><td>int64</td><td>long</td><td>integer/string</td><td>Bignum</td></tr>
<tr><td><a name="uint32" /> uint32</td><td>Uses variable-length encoding.</td><td>uint32</td><td>int</td><td>int/long</td><td>uint32</td><td>uint</td><td>integer</td><td>Bignum or Fixnum (as required)</td></tr>
<tr><td><a name="uint64" /> uint64</td><td>Uses variable-length encoding.</td><td>uint64</td><td>long</td><td>int/long</td><td>uint64</td><td>ulong</td><td>integer/string</td><td>Bignum or Fixnum (as required)</td></tr>
<tr><td><a name="sint32" /> sint32</td><td>Uses variable-length encoding. Signed int value. These more efficiently encode negative numbers than regular int32s.</td><td>int32</td><td>int</td><td>int</td><td>int32</td><td>int</td><td>integer</td><td>Bignum or Fixnum (as required)</td></tr>
<tr><td><a name="sint64" /> sint64</td><td>Uses variable-length encoding. Signed int value. These more efficiently encode negative numbers than regular int64s.</td><td>int64</td><td>long</td><td>int/long</td><td>int64</td><td>long</td><td>integer/string</td><td>Bignum</td></tr>
<tr><td><a name="fixed32" /> fixed32</td><td>Always four bytes. More efficient than uint32 if values are often greater than 2^28.</td><td>uint32</td><td>int</td><td>int</td><td>uint32</td><td>uint</td><td>integer</td><td>Bignum or Fixnum (as required)</td></tr>
<tr><td><a name="fixed64" /> fixed64</td><td>Always eight bytes. More efficient than uint64 if values are often greater than 2^56.</td><td>uint64</td><td>long</td><td>int/long</td><td>uint64</td><td>ulong</td><td>integer/string</td><td>Bignum</td></tr>
<tr><td><a name="sfixed32" /> sfixed32</td><td>Always four bytes.</td><td>int32</td><td>int</td><td>int</td><td>int32</td><td>int</td><td>integer</td><td>Bignum or Fixnum (as required)</td></tr>
<tr><td><a name="sfixed64" /> sfixed64</td><td>Always eight bytes.</td><td>int64</td><td>long</td><td>int/long</td><td>int64</td><td>long</td><td>integer/string</td><td>Bignum</td></tr>
<tr><td><a name="bool" /> bool</td><td></td><td>bool</td><td>boolean</td><td>boolean</td><td>bool</td><td>bool</td><td>boolean</td><td>TrueClass/FalseClass</td></tr>
<tr><td><a name="string" /> string</td><td>A string must always contain UTF-8 encoded or 7-bit ASCII text.</td><td>string</td><td>String</td><td>str/unicode</td><td>string</td><td>string</td><td>string</td><td>String (UTF-8)</td></tr>
<tr><td><a name="bytes" /> bytes</td><td>May contain any arbitrary sequence of bytes.</td><td>string</td><td>ByteString</td><td>str</td><td>[]byte</td><td>ByteString</td><td>string</td><td>String (ASCII-8BIT)</td></tr>
</tbody></table>
</div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
